<!-- example:autocomplete with jquery  -->

<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <title>jQuery UI Autocomplete functionality</title>
      <link href="http://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
      <!-- <script src="http://code.jquery.com/jquery-1.10.2.js"></script> -->
      <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.0/knockout-min.js"></script>

      <!-- Javascript -->
      <script>
		ko.bindingHandlers.ko_autocomplete = {
		    init: function(element, params) {
		        $(element).autocomplete(params());
		    },
		    update: function(element, params) {
		        $(element).autocomplete("option", "source", params().source);
		    }
		};

		var AutoCompleteExample;
		(function(AutoCompleteExample) {

		    var ViewModel = (function() {

		        function ViewModel() {
		            this.selectedValue = ko.observable();
		            this.selectLanguage = this.selectLanguage.bind(this);
		        }

		        ViewModel.prototype.getLanguages = function(request, response) {
		            var text = request.term;
		            $.ajax({
		                type: 'POST',
		                url: '/echo/json/',
		                data: {
		                    json: '{}',
		                    delay: 0.5
		                },
		                success: function(data) {
		                    // fake response
		                    data = mockWebApiResponse(text);
		                    response($.map(data, function(language) {
		                        return {
		                            languageValue: language.value,
		                            label: language.label
		                        };
		                    }));
		                }
		            });
		        };

		        ViewModel.prototype.selectLanguage = function(event, ui) {
		            this.selectedValue(ui.item.languageValue);
		        };

		        return ViewModel;

		    })();
		    AutoCompleteExample.ViewModel = ViewModel;

		    var availableLanguages = [
		            { label: "ActionScript", value: 1 },
		            { label: "AppleScript", value: 2 },
		            { label: "Asp", value: 3 },
		            { label: "BASIC", value: 4 },
		            { label: "C", value: 5 },
		            { label: "C++", value: 6 },
		            { label: "Clojure", value: 7 },
		            { label: "COBOL", value: 8 },
		            { label: "ColdFusion", value: 9 },
		            { label: "Erlang", value: 10 },
		            { label: "Fortran", value: 11 },
		            { label: "Groovy", value: 12 },
		            { label: "Haskell", value: 13 },
		            { label: "Java", value: 14 },
		            { label: "JavaScript", value: 15 },
		            { label: "Lisp", value: 16 },
		            { label: "Perl", value: 17 },
		            { label: "PHP", value: 18 },
		            { label: "Python", value: 19 },
		            { label: "Ruby", value: 20 },
		            { label: "Scala", value: 21 },
		            { label: "Scheme", value: 22 }
		    ];
		    
		    // mock server-side logic
		    function mockWebApiResponse(text) {
		        return $.grep(availableLanguages, function(l) {
		            return l.label.toLowerCase().match("^" + text);
		        });
		    }

		})(AutoCompleteExample || (AutoCompleteExample = {}));

		ko.applyBindings(new AutoCompleteExample.ViewModel());
      </script>
   </head>
   <body>
      <!-- HTML -->
	<label for="name-search" >Search language: </label>
	<input type="text" id="name-search" data-bind="ko_autocomplete: { source: getLanguages, select: selectLanguage }"/>
	<div style="margin-top:1em">
	    You selected: <span data-bind="text: $data.selectedValue"></span>
	</div>    

      </div>
   </body>
</html>